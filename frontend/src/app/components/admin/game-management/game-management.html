<div class="game-management-container" style="margin-top: 80px;">
  <div class="header d-flex justify-content-between align-items-center mb-4">
    <h1 class="mb-0">Game Management</h1>
    <button class="btn btn-primary shadow-sm" (click)="openCreateForm()" [disabled]="loading">
      <span class="fw-bold">+</span> Create New Game
    </button>
  </div>

  <!-- Search Bar -->
  <div class="search-bar">
    <input 
      type="text" 
      [(ngModel)]="searchTerm" 
      (keyup.enter)="searchGames()"
      placeholder="Search by name, developer, publisher, or AppID..."
      class="search-input"
    />
    <button (click)="searchGames()" class="btn btn-secondary" [disabled]="loading">
      Search
    </button>
  </div>

  <!-- Loading Spinner -->
  <div *ngIf="loading" class="loading-spinner">
    <div class="spinner"></div>
    <p>Loading games...</p>
  </div>

  <!-- Games Table -->
  <div *ngIf="!loading && !showForm" class="games-table-container">
    <table class="table table-striped table-hover align-middle shadow-sm">
      <thead class="table-dark">
        <tr>
          <th>AppID</th>
          <th>Name</th>
          <th>Developer</th>
          <th>Publisher</th>
          <th>Price (GBP)</th>
          <th>Review Score</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let game of games">
          <td><span class="badge bg-secondary">{{ game.appid }}</span></td>
          <td>
            <a [routerLink]="['/games', game.appid]" class="game-link fw-semibold text-decoration-none">
              {{ game.name }}
            </a>
          </td>
          <td>
            <span *ngFor="let dev of game.developers; let last = last">
              <span class="badge bg-info text-dark me-1">{{ dev }}</span><span *ngIf="!last"> </span>
            </span>
            <span *ngIf="!game.developers || !game.developers.length" class="text-muted">N/A</span>
          </td>
          <td>
            <span *ngFor="let pub of game.publishers; let last = last">
              <span class="badge bg-warning text-dark me-1">{{ pub }}</span><span *ngIf="!last"> </span>
            </span>
            <span *ngIf="!game.publishers || !game.publishers.length" class="text-muted">N/A</span>
          </td>
          <td>
            <span class="badge" [ngClass]="game.price === 0 ? 'bg-success' : 'bg-primary'">
              {{ formatGBP(game.price) }}
            </span>
          </td>
          <td>
            <span class="badge bg-success" *ngIf="game.review_score !== undefined">{{ game.review_score }}%</span>
            <span class="badge bg-secondary" *ngIf="game.review_score === undefined">N/A</span>
          </td>
          <td class="actions">
            <button class="btn btn-sm btn-outline-primary me-1" (click)="openEditForm(game)">
              Edit
            </button>
            <button class="btn btn-sm btn-outline-danger" (click)="deleteGame(game)">
              Delete
            </button>
          </td>
        </tr>
      </tbody>
    </table>

    <!-- Pagination -->
    <div class="pagination">
      <button (click)="prevPage()" [disabled]="currentPage === 1" class="btn btn-secondary">
        ← Previous
      </button>
      <span class="page-info">Page {{ currentPage }} of {{ totalPages }}</span>
      <button (click)="nextPage()" [disabled]="currentPage >= totalPages" class="btn btn-secondary">
        Next →
      </button>
    </div>
  </div>

  <!-- Game Form (Create/Edit) -->
  <div *ngIf="showForm" class="game-form-container">
    <div class="form-header">
      <h2>{{ isEditing ? 'Edit Game' : 'Create New Game' }}</h2>
      <button class="btn btn-secondary" (click)="closeForm()">Cancel</button>
    </div>

    <form class="game-form" (ngSubmit)="saveGame()">
      <div class="form-row">
        <div class="form-group">
          <label for="appid">AppID *</label>
          <input 
            type="number" 
            id="appid" 
            [(ngModel)]="currentGame.appid" 
            name="appid"
            [disabled]="isEditing"
            required
          />
        </div>

        <div class="form-group">
          <label for="name">Game Name *</label>
          <input 
            type="text" 
            id="name" 
            [(ngModel)]="currentGame.name" 
            name="name"
            required
          />
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label for="developer">Developer</label>
          <input 
            type="text" 
            id="developer" 
            [(ngModel)]="currentGame.developer" 
            name="developer"
          />
        </div>

        <div class="form-group">
          <label for="publisher">Publisher</label>
          <input 
            type="text" 
            id="publisher" 
            [(ngModel)]="currentGame.publisher" 
            name="publisher"
          />
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label for="release_date">Release Date</label>
          <input 
            type="text" 
            id="release_date" 
            [(ngModel)]="currentGame.release_date" 
            name="release_date"
            placeholder="e.g. Jan 1, 2020"
          />
        </div>

        <div class="form-group">
          <label for="price">Price (GBP)</label>
          <input 
            type="number" 
            id="price" 
            [(ngModel)]="currentGame.price" 
            name="price"
            step="0.01"
            min="0"
          />
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label for="positive">Positive Reviews</label>
          <input 
            type="number" 
            id="positive" 
            [(ngModel)]="currentGame.positive" 
            name="positive"
            min="0"
          />
        </div>

        <div class="form-group">
          <label for="negative">Negative Reviews</label>
          <input 
            type="number" 
            id="negative" 
            [(ngModel)]="currentGame.negative" 
            name="negative"
            min="0"
          />
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label for="metacritic_score">Metacritic Score</label>
          <input 
            type="number" 
            id="metacritic_score" 
            [(ngModel)]="currentGame.metacritic_score" 
            name="metacritic_score"
            min="0"
            max="100"
          />
        </div>

        <div class="form-group">
          <label for="peak_ccu">Peak CCU</label>
          <input 
            type="number" 
            id="peak_ccu" 
            [(ngModel)]="currentGame.peak_ccu" 
            name="peak_ccu"
            min="0"
          />
        </div>
      </div>

      <div class="form-group full-width">
        <label for="genres">Genres (comma-separated)</label>
        <input 
          type="text" 
          id="genres" 
          [(ngModel)]="currentGame.genres" 
          name="genres"
          placeholder="Action, Adventure, RPG"
        />
      </div>

      <div class="form-group full-width">
        <label for="tags">Tags (comma-separated)</label>
        <input 
          type="text" 
          id="tags" 
          [(ngModel)]="currentGame.tags" 
          name="tags"
          placeholder="Singleplayer, Multiplayer, Co-op"
        />
      </div>

      <div class="form-group full-width">
        <label for="short_description">Short Description</label>
        <textarea 
          id="short_description" 
          [(ngModel)]="currentGame.short_description" 
          name="short_description"
          rows="3"
        ></textarea>
      </div>

      <div class="form-group full-width">
        <label for="header_image">Header Image URL</label>
        <input 
          type="text" 
          id="header_image" 
          [(ngModel)]="currentGame.header_image" 
          name="header_image"
          placeholder="https://cdn.cloudflare.steamstatic.com/steam/apps/..."
        />
        <div style="margin-top: 10px;">
          <img [src]="currentGame.header_image || 'assets/not-available.png'"
               (error)="onImageError($event)"
               alt="Header Preview"
               style="max-width: 300px; max-height: 120px; border: 1px solid #ccc; background: #f8f8f8; object-fit: contain;">
        </div>
      </div>

      <div class="form-actions">
        <button type="submit" class="btn btn-primary" [disabled]="loading">
          {{ isEditing ? 'Update Game' : 'Create Game' }}
        </button>
        <button type="button" class="btn btn-secondary" (click)="closeForm()">
          Cancel
        </button>
      </div>
    </form>
  </div>
</div>
